<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>ç‚ºäº†éŒ¢éŒ¢</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111827">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ç‚ºäº†éŒ¢éŒ¢">

<style>
body{
  font-family: system-ui,-apple-system,"Segoe UI",Arial,sans-serif;
  background:#f6f7fb;
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
}
.card{
  width:min(820px,98vw);
  background:#fff;
  border-radius:16px;
  box-shadow:0 8px 24px rgba(0,0,0,.08);
  padding:18px;
}
h1{font-size:20px;margin:0 0 10px}
.hint{color:#555;font-size:13px;margin-bottom:14px;line-height:1.6}

.ringBoard{
  display:grid;
  grid-template-columns:96px 1fr 1fr 1fr 96px;
  grid-template-rows:56px 1fr 1fr 1fr 56px;
  gap:10px;
}

.ringBtn{
  border:0;border-radius:12px;
  padding:8px 6px;
  cursor:pointer;
  color:#fff;font-weight:800;
  box-shadow:0 6px 14px rgba(0,0,0,.18);
  white-space:pre-line;
}
.ringBtn:active{transform:translateY(1px)}
.bRow{background:#1f6feb}
.bCol{background:#10b981}
.bDiag{background:#6f42c1}

.gridWrap{
  grid-column:2/5;grid-row:2/5;
  background:#f1f3f9;
  border-radius:16px;
  padding:12px;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  grid-template-rows:repeat(3,1fr);
  gap:10px;
  min-width:320px;
  min-height:320px;
}

.cell{
  background:#fff;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  box-shadow:0 6px 14px rgba(0,0,0,.06);
}
.idx{
  position:absolute;
  top:8px;left:10px;
  font-size:11px;color:#888;
}
input{
  width:70%;height:55%;
  text-align:center;
  font-size:24px;
  border:1px solid #d8dbea;
  border-radius:12px;
  outline:none;
}

.ringBtn,.btn,input{touch-action:manipulation}

.actions{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
.btn{
  border:0;border-radius:12px;
  padding:10px 12px;
  cursor:pointer;font-weight:800;
  background:#111827;color:#fff;
}
.btn.ghost{background:#e5e7eb;color:#111827}

.msg{
  margin-top:12px;
  background:#0b1220;color:#e5e7eb;
  border-radius:12px;
  padding:12px;
  font-size:13px;
  line-height:1.6;
  white-space:pre-wrap;
  min-height:120px;
}
</style>
</head>

<body>
<div class="card">
<h1>ç‚ºäº†éŒ¢éŒ¢ ğŸ’°</h1>
<div class="hint">
ç‚ºäº†éŒ¢éŒ¢ã€‚<br>
å¤–åœˆæŒ‰éˆ•æœƒå‘Šè¨´ä½ ã€Œé‚„æœ‰å“ªå¹¾ç¨®å¯èƒ½è³ºæ³•ã€ã€‚
</div>

<div class="ringBoard" id="board">
  <div class="gridWrap" id="grid"></div>
</div>

<div class="actions">
  <button class="btn ghost" id="btnClear">æ¸…ç©º</button>
</div>

<div class="msg" id="msg">ç‚ºäº†éŒ¢éŒ¢ï¼Œè«‹è¼¸å…¥æ•¸å­—ã€‚</div>
</div>

<script>
const msg = t => document.getElementById("msg").textContent = t;
const boardEl = document.getElementById("board");
const gridEl = document.getElementById("grid");
const inputs=[];

for(let i=1;i<=9;i++){
  const c=document.createElement("div");c.className="cell";
  const idx=document.createElement("div");idx.className="idx";idx.textContent=i;
  const inp=document.createElement("input");

  inp.type="text";
  inp.inputMode="numeric";
  inp.pattern="[1-9]";
  inp.maxLength=1;
  inp.autocomplete="off";
  inp.spellcheck=false;

  inp.addEventListener("paste",e=>{
    e.preventDefault();
    const m=(e.clipboardData.getData("text")||"").match(/[1-9]/);
    inp.value=m?m[0]:"";
    inp.dispatchEvent(new Event("input",{bubbles:true}));
  });

  inp.addEventListener("input",()=>{
    const m=inp.value.match(/[1-9]/);
    inp.value=m?m[0]:"";
    if(!inp.value){msg("æ¸…ç©ºä¸€æ ¼");return;}
    if(inputs.some(x=>x!==inp&&x.value===inp.value)){
      inp.value="";msg("æ•¸å­—ä¸èƒ½é‡è¤‡");return;
    }
    msg("è¼¸å…¥ï¼š"+inp.value);
  });

  c.append(idx,inp);gridEl.append(c);inputs.push(inp);
}

const rows=r=>[(r-1)*3+1,(r-1)*3+2,(r-1)*3+3];
const cols=c=>[c,c+3,c+6];
const diag1=[1,5,9],diag2=[3,5,7];

function read(){
  const b=Array(9).fill(null);
  for(let i=0;i<9;i++) if(inputs[i].value) b[i]=+inputs[i].value;
  return b;
}

function possible(b,idxs){
  const used=new Set(b.filter(v=>v));
  const rest=[1,2,3,4,5,6,7,8,9].filter(x=>!used.has(x));
  const empty=b.map((v,i)=>v?null:i).filter(v=>v!==null);
  const sums=new Set();

  function dfs(i,cur){
    if(i===empty.length){
      sums.add(idxs.reduce((a,p)=>a+cur[p-1],0));return;
    }
    for(const d of rest){
      if(cur.includes(d))continue;
      cur[empty[i]]=d;
      dfs(i+1,cur);
      cur[empty[i]]=null;
    }
  }
  dfs(0,b.slice());
  return [...sums].sort((a,b)=>a-b);
}

function addBtn(r,c,t,cls,idxs){
  const b=document.createElement("button");
  b.className=`ringBtn ${cls}`;
  b.style.gridRow=r;b.style.gridColumn=c;
  b.textContent=t;
  b.onclick=()=>{
    const board=read();
    const p=possible(board,idxs);
    msg(`å¯èƒ½çš„ç¸½é¡ï¼š\n${p.join(", ")}`);
  };
  boardEl.append(b);
}

addBtn(1,1,"ä¸»å°è§’","bDiag",diag1);
addBtn(5,5,"ä¸»å°è§’","bDiag",diag1);
addBtn(1,5,"å‰¯å°è§’","bDiag",diag2);
addBtn(5,1,"å‰¯å°è§’","bDiag",diag2);

for(let i=1;i<=3;i++){
  addBtn(1,i+1,`æ¬„${i}`,"bCol",cols(i));
  addBtn(5,i+1,`æ¬„${i}`,"bCol",cols(i));
  addBtn(i+1,1,`åˆ—${i}`,"bRow",rows(i));
  addBtn(i+1,5,`åˆ—${i}`,"bRow",rows(i));
}

document.getElementById("btnClear").onclick=()=>{
  inputs.forEach(i=>i.value="");msg("é‡æ–°ç‚ºäº†éŒ¢éŒ¢");
};

if("serviceWorker"in navigator){
  navigator.serviceWorker.register("./sw.js");
}
</script>
</body>
</html>
